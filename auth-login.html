<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录 / 注册 - UNDEFINED</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --brand-green: #2D6A5E;
            --brand-accent: #7FBF6E;
            --neutral-cream: #F5F3EF;
            --neutral-dark: #1A1A2E;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--brand-green) 0%, #1F4A40 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 450px;
            width: 100%;
            overflow: hidden;
        }
        
        .auth-header {
            background: var(--brand-green);
            color: white;
            padding: 40px 40px 30px;
            text-align: center;
        }
        
        .auth-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            margin-bottom: 8px;
        }
        
        .auth-header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .auth-tabs {
            display: flex;
            background: var(--neutral-cream);
        }
        
        .auth-tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--neutral-dark);
            border: none;
            background: none;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            background: white;
            color: var(--brand-green);
        }
        
        .auth-body {
            padding: 40px;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--neutral-dark);
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E5E5;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--brand-green);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E5E5;
            border-radius: 8px;
            font-size: 15px;
            background: white;
        }
        
        .btn-primary {
            width: 100%;
            padding: 14px;
            background: var(--brand-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background: #1F4A40;
            transform: translateY(-2px);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .alert-success {
            background: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
        }
        
        .alert-error {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
        }
        
        .divider {
            text-align: center;
            margin: 24px 0;
            color: #999;
            font-size: 14px;
        }
        
        .back-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .back-link a {
            color: var(--brand-green);
            text-decoration: none;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-header">
            <h1>undefined.</h1>
            <p>Service-First Delivery Platform</p>
        </div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchTab('login')">登录</button>
            <button class="auth-tab" onclick="switchTab('signup')">注册</button>
        </div>
        
        <div class="auth-body">
            <!-- 登录表单 -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div id="loginMessage"></div>
                
                <div class="form-group">
                    <label class="form-label">邮箱</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="••••••••" required>
                </div>
                
                <button type="submit" class="btn-primary" id="loginBtn">登录</button>
                
                <div class="divider">或</div>
                
                <button type="button" class="btn-primary" style="background: white; color: var(--brand-green); border: 2px solid var(--brand-green);" onclick="alert('Google登录即将推出！')">
                    使用 Google 登录
                </button>
            </form>
            
            <!-- 注册表单 -->
            <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                <div id="signupMessage"></div>
                
                <div class="form-group">
                    <label class="form-label">姓名</label>
                    <input type="text" class="form-input" id="signupName" placeholder="张三" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">邮箱</label>
                    <input type="email" class="form-input" id="signupEmail" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">手机号</label>
                    <input type="tel" class="form-input" id="signupPhone" placeholder="+31 6 12345678" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">我是</label>
                    <select class="form-select" id="signupRole" required>
                        <option value="">请选择...</option>
                        <option value="consumer">消费者 - 我想点餐</option>
                        <option value="merchant">商家 - 我想入驻</option>
                        <option value="rider">骑手 - 我想配送</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-input" id="signupPassword" placeholder="至少6位" minlength="6" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">确认密码</label>
                    <input type="password" class="form-input" id="signupPasswordConfirm" placeholder="再次输入密码" required>
                </div>
                
                <button type="submit" class="btn-primary" id="signupBtn">创建账号</button>
            </form>
            
            <div class="back-link">
                <a href="/">← 返回主页</a>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="/firebase-config.js"></script>
    
    <script>
        function switchTab(tab) {
            // 切换标签激活状态
            document.querySelectorAll('.auth-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 切换表单显示
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');
            
            // 清除消息
            document.getElementById('loginMessage').innerHTML = '';
            document.getElementById('signupMessage').innerHTML = '';
        }
        
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const messageDiv = document.getElementById('loginMessage');
            
            btn.disabled = true;
            btn.textContent = '登录中...';
            messageDiv.innerHTML = '';
            
            try {
                // 使用 Firebase Auth 登录
                const auth = firebase.auth();
                const result = await auth.signInWithEmailAndPassword(email, password);
                
                messageDiv.innerHTML = '<div class="alert alert-success">✅ 登录成功！正在跳转...</div>';
                
                // 根据用户角色跳转
                const db = firebase.firestore();
                const userDoc = await db.collection('users').doc(result.user.uid).get();
                const userData = userDoc.data();
                
                setTimeout(() => {
                    if (userData.role === 'merchant') {
                        window.location.href = '/merchant-dashboard.html';
                    } else if (userData.role === 'rider') {
                        window.location.href = '/rider-dashboard.html';
                    } else {
                        window.location.href = '/consumer-browse.html';
                    }
                }, 1500);
                
            } catch (error) {
                console.error('登录错误:', error);
                let errorMessage = '登录失败，请检查邮箱和密码';
                
                if (error.code === 'auth/user-not-found') {
                    errorMessage = '该邮箱未注册';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = '密码错误';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = '邮箱格式不正确';
                }
                
                messageDiv.innerHTML = `<div class="alert alert-error">❌ ${errorMessage}</div>`;
                btn.disabled = false;
                btn.textContent = '登录';
            }
        }
        
        async function handleSignup(event) {
            event.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const phone = document.getElementById('signupPhone').value;
            const role = document.getElementById('signupRole').value;
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            const btn = document.getElementById('signupBtn');
            const messageDiv = document.getElementById('signupMessage');
            
            // 验证密码
            if (password !== passwordConfirm) {
                messageDiv.innerHTML = '<div class="alert alert-error">❌ 两次输入的密码不一致</div>';
                return;
            }
            
            btn.disabled = true;
            btn.textContent = '注册中...';
            messageDiv.innerHTML = '';
            
            try {
                const auth = firebase.auth();
                const db = firebase.firestore();
                
                // 创建用户
                const result = await auth.createUserWithEmailAndPassword(email, password);
                
                // 保存用户信息到 Firestore
                await db.collection('users').doc(result.user.uid).set({
                    name: name,
                    email: email,
                    phone: phone,
                    role: role,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    totalOrders: 0,
                    totalSpent: 0,
                    donationTotal: 0
                });
                
                messageDiv.innerHTML = '<div class="alert alert-success">✅ 注册成功！正在跳转...</div>';
                
                setTimeout(() => {
                    if (role === 'merchant') {
                        window.location.href = '/merchant-onboarding.html';
                    } else if (role === 'rider') {
                        window.location.href = '/rider-onboarding.html';
                    } else {
                        window.location.href = '/consumer-browse.html';
                    }
                }, 1500);
                
            } catch (error) {
                console.error('注册错误:', error);
                let errorMessage = '注册失败，请重试';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = '该邮箱已被注册';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = '邮箱格式不正确';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = '密码强度太弱，至少需要6位';
                }
                
                messageDiv.innerHTML = `<div class="alert alert-error">❌ ${errorMessage}</div>`;
                btn.disabled = false;
                btn.textContent = '创建账号';
            }
        }
    </script>
</body>
</html>
